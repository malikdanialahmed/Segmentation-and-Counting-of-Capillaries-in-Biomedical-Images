# Capillary Segmentation and Counting for Microvascular Analysis

**Project Status:** Completed (Academic/Proof-of-Concept)
**Context:** Medical Image Analysis, Universit√© Bourgogne Europe (June 2025)

---

## üí° Project Overview

This project implements a **robust, semi-automated image processing pipeline** for the **segmentation and quantification of microvascular structures (capillaries)** from native clinical images.

Accurate quantification of capillaries (e.g., in the tongue or nailfold) is crucial for the early diagnosis and monitoring of chronic diseases such as **diabetes and hypertension**. Our solution replaces slow, subjective manual methods with an objective, data-driven approach.

### üéØ Problem Solved

Manual segmentation of capillaries is tedious and prone to human error, especially given the low-contrast and noisy nature of microvascular imagery. This project addresses this by creating an adaptable pipeline that reliably isolates and counts individual capillary units across varying image quality conditions.

---

## üöÄ Methodology

The core of this project is an end-to-end image processing workflow built to enhance, segment, and quantify vessels.

### 1. Image Preprocessing

* **Noise Reduction:** Utilized **Median Filtering ($5\times5$)** to suppress common salt-and-pepper noise.
* **Local Contrast Enhancement:** Applied **CLAHE (Contrast Limited Adaptive Histogram Equalization)** with customized parameters (e.g., clip limit of 3.0 to 4.0) to reveal low-contrast vessels while limiting noise amplification.
* **Normalization:** Scaling image intensity values to a standard range (0-1) for consistent filter performance.

### 2. Robust Vesselness Filtering

To highlight the tubular structure of capillaries, a combined filter approach was used for maximum robustness:
* **Frangi Filter**
* **Sato Filter**
* **Meijering Filter**

The **Combined Vesselness Map** was generated by averaging the outputs of these three Hessian matrix-based filters.

### 3. Segmentation and Post-Processing

* **Binarization:** Used **Otsu's Thresholding** to automatically determine the optimal global threshold on the vesselness map, creating a binary mask.
* **Morphological Operations:** Applied **Closing** to fill small gaps, and aggressively filtered the mask by removing small artifacts and filling holes (with parameters tuned for each dataset‚ÄîN1, N2, S2, S3‚Äîto handle varying noise/detail levels).

### 4. Capillary Counting

For the N1 dataset, a specialized counting algorithm was developed:
* **ROI Alignment:** The image and mask were rotated using **OpenCV affine transformations** to ensure all capillaries were horizontally aligned, normalizing the analysis orientation.
* **Quantification:** **Connected Components Analysis** was performed within a standardized window to precisely count the number of distinct white regions, corresponding to individual capillaries.

---

## üíª Technologies and Libraries

| Category | Tools/Libraries/Concepts |
| :--- | :--- |
| **Language** | Python |
| **Core Libraries** | **OpenCV** (for image manipulation, rotation, connected components) |
| **Image Analysis** | **scikit-image** (for Frangi, Sato, Meijering filters) |
| **Data Handling** | NumPy, Pandas |
| **Concepts** | CLAHE, Otsu's Thresholding, Connected Components Analysis |

---

## üìä Key Results

The pipeline was successfully adapted and tested across four distinct datasets (N1, N2, S2, S3) from clinical sources, proving its ability to generalize across different image qualities. The capillary counting mechanism demonstrated a reasonable correlation with ground truth values, providing a foundation for objective quantitative analysis.

| Metric | Outcome |
| :--- | :--- |
| **Segmentation** | High-fidelity binary masks generated for four datasets (N1, N2, S2, S3). |
| **Adaptability** | Successfully segmented noisy and low-contrast images by tuning CLAHE and morphological parameters. |
| **Counting** | Algorithm quantified the number of capillaries in the N1 dataset (e.g., N1a.jpg: 7 detected vs. 6 Ground Truth). |

---

## üîÆ Future Work

While classical methods provided a robust starting point, future development will focus on integrating advanced techniques to maximize accuracy:

1.  **Deep Learning Integration:** Transition to a **U-Net** or similar **Convolutional Neural Network (CNN)** architecture for superior segmentation accuracy and better generalization across new datasets.
2.  **Counting Refinement:** Implementing a center-line detection or skeletonization approach to eliminate over-segmentation and ensure each counted object corresponds to a single, continuous vessel.
3.  **Real-Time Processing:** Optimizing the pipeline for faster execution suitable for a clinical or research environment.

---

## ü§ù Authors and Acknowledgements

This project was submitted as part of the Medical Image Analysis course curriculum.

* **Malik Danial Ahmed**
* **Somaia Elbaradey**

**Institution:** Department of Computer Vision and Robotics, Universit√© Bourgogne Europe
